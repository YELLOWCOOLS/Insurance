<extend name="Public:menuLayout" />
<block name="vendor-style">
    <load href="__PUBLIC__/Admin/vendor/datatables-colvis/css/dataTables.colVis.css" />
    <load href="__PUBLIC__/Admin/vendor/datatables/media/css/dataTables.bootstrap.css" />
    <load href="__PUBLIC__/Admin/vendor/dataTables.fontAwesome/index.css" />
    <load href="__PUBLIC__/Admin/vendor/sweetalert/dist/sweetalert.css" />
    <load href="__PUBLIC__/Admin/vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
</block>
<block name="title">校友信息查询</block>
<block name="content">
    <div class="container-fluid">
        <!-- <div class="row">
            <div class="col-lg-12">
                <div id="export-panel" class="panel panel-default">
                    <div class="panel-heading panel-heading-collapsed">导出操作
                        <a href="javascript:;" data-tool="panel-collapse" data-toggle="tooltip" title="折叠" class="pull-right">
                            <em class="fa fa-plus"></em>
                        </a>
                    </div>
                    <div class="panel-wrapper collapse">
                        <div class="panel-body">
                            <form action="/admin/Candidate/doExportExcelUser" method="POST" name="exportExecl">
                                <div class="row form-horizontal">
                                    <div class="col-md-5">
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">起始日期</label>
                                            <div class="col-md-9">
                                                <div class="input-group date" id="datetimepicker-start">
                                                    <input type="text" class="form-control" name="start_date">
                                                    <span class="input-group-addon">
                                                        <span class="fa fa-calendar"></span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">结束日期</label>
                                            <div class="col-md-9">
                                                <div class="input-group date" id="datetimepicker-end">
                                                    <input type="text" class="form-control" name="end_date">
                                                    <span class="input-group-addon">
                                                        <span class="fa fa-calendar"></span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="btn-group mb-sm">
                                            <button id="btnSubmit" class="btn btn-primary">导出Excel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <table id="datatable" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>入学年份</th>
                                    <th>生日</th>
                                    <th>电话</th>
                                    <th>邮箱</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <volist name="users" id="user">
                                    <tr>
                                        <td>{$user.username} </td>
                                        <td>{$user.enroll_year}</td>
                                        <td>{$user.birthday}</td>
                                        <td>{$user.phone}</td>
                                        <td>{$user.email}</td>
                                        <td><a class="btn btn-xs btn-default" href="/admin/candidate/view/openid/{$user.openid}"><i class="fa fa-search"></i></a>&nbsp;<a class="btn btn-danger btn-xs" href="javascript:;" data-remove="{$user.openid}"><i class="fa fa-trash"></i></a></td>
                                    </tr>
                                </volist>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="vendor-script">
    <script src="__PUBLIC__/Admin/vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="__PUBLIC__/Admin/vendor/datatables-colvis/js/dataTables.colVis.js"></script>
    <script src="__PUBLIC__/Admin/vendor/datatables/media/js/dataTables.bootstrap.js"></script>
    <script src="__PUBLIC__/Admin/vendor/sweetalert/dist/sweetalert.min.js"></script>
    <script src="__PUBLIC__/Admin/vendor/moment/min/moment-with-locales.min.js"></script>
    <script src="__PUBLIC__/Admin/vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
</block>
<block name="script">
    <script>
    $(function() {
        //datatable初始化
        $('#datatable').dataTable({
            dom: 'lfrt<"table-toolbar mv-lg">p',
            paging: true,
            order: [
                [1, 'desc']
            ],
            info: true,
            oLanguage: {
                sSearch: '搜索',
                sLengthMenu: '每页显示 _MENU_ 条记录',
                sInfo: '第 _PAGE_ 页，共 _PAGES_ 页',
                sZeroRecords: '没有相关记录',
                sInfoEmpty: '0条记录',
                sInfoFiltered: '(从 _MAX_ 条记录过滤)',
                oPaginate: {
                    sPrevious: '上一页',
                    sNext: '下一页'
                }
            }
        });


        $('#downAvatar').click(function(e) {
            $('[name="type"]').val('avatar');
            document.forms['downloadzip'].submit();
        });

        $('#downCertificate').click(function(e) {
            $('[name="type"]').val('certificate');
            document.forms['downloadzip'].submit();
        });
        $('#downReport').click(function(e) {
            $('[name="type"]').val('report');
            document.forms['downloadzip'].submit();
        });
                //导出panel
        $('#export-panel').on('click', '[data-tool="panel-collapse"]', function() {
            $(this).find('em').toggleClass('fa-minus').toggleClass('fa-plus');
            $(this).parent().toggleClass('panel-heading-collapsed');
            $(this).parent().siblings('.panel-wrapper').slideToggle(200).toggleClass('in');
        });
        $('#datetimepicker-start').datetimepicker({
            icons: {
                time: "fa fa-clock-o",
                date: "fa fa-calendar",
                up: "fa fa-arrow-up",
                down: "fa fa-arrow-down"
            },
            format: 'YYYY-MM-DD'
        });
        $('#datetimepicker-end').datetimepicker({
            icons: {
                time: "fa fa-clock-o",
                date: "fa fa-calendar",
                up: "fa fa-arrow-up",
                down: "fa fa-arrow-down"
            },
            format: 'YYYY-MM-DD',
            maxDate:moment(),
            useCurrent: false
        });
        $("#datetimepicker-start").on("dp.change", function(e) {
            $("#datetimepicker-end").data("DateTimePicker").minDate(e.date);
        });
        $("#datetimepicker-end").on("dp.change", function(e) {
            $("#datetimepicker-start").data("DateTimePicker").maxDate(e.date);
        });
        //导出Excel
        $('#btnSubmit').click(function(e) {
            e.preventDefault();
            if(!$('[name="start_date"]').val()){
                alert('起始日期不能为空!');
                return;
            }
            if(!$('[name="end_date"]').val()){
                alert('结束日期不能为空!');
                return;
            }
            document.forms['exportExecl'].submit();
        });
        //删除学生
        $('#datatable').on('click','[data-remove]',function(){
            var userId = $(this).data('remove');
            swal({
              title: "确认删除该学生吗?",
              text: "删除后将无法恢复，请谨慎操作",
              type: "warning",
              showCancelButton: true,
              confirmButtonColor: "#DD6B55",
              confirmButtonText: "是的",
              cancelButtonText:"取消",
              closeOnConfirm: false
            },
            function(){
                $.post('/admin/candidate/ajaxRemoveCandidate',{openid:userId},function(res){
                    if(res==='ok'){
                        swal({
                          title: "删除成功",
                          type: "success",
                        },function(){
                            window.location.reload();   
                        });
                    }
                });
            });
        });
    });
    </script>
</block>

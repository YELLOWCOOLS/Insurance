<extend name="Public:layout" />
<block name="style">
  <load href="__PUBLIC__/Admin/vendor/datatables-colvis/css/dataTables.colVis.css" />
  <load href="__PUBLIC__/Admin/vendor/datatables/media/css/dataTables.bootstrap.css" />
  <load href="__PUBLIC__/Admin/vendor/dataTables.fontAwesome/index.css" />
  <load href="__PUBLIC__/Admin/vendor/sweetalert/dist/sweetalert.css" />
  <load href="__PUBLIC__/Admin/vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
  <load href="__PUBLIC__/Admin/css/zy.css" />
  <load href="__PUBLIC__/Admin/css/bootstrap.css" id="bscss" />
</block>
<block name="content">
  <div class="tpl-content-wrapper">
    <div class="tpl-content-page-title">
      项目确定
    </div>
    <ol class="am-breadcrumb">
      <li><a href="#" class="am-icon-home">首页</a></li>
      <li><a href="#">解析结果确认</a></li>
    </ol>
    <div class="container-fluid page1">
      <div class="row">
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <table id="datatable" class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th class="col-2" style=“width:15%">保险条目</th>
                    <th class="col-8" style='width:60%'>条目解释</th>
                    <th class="col-2" style='width:25%'>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <volist name="all" id="al">
                    <tr>
                      <td>{$al.name} </td>
                      <td>{$al.exp}</td>
                      <td>
                        <a class="btn btn-xs btn-default" href="javascript:;" data-updenaid="{$al.num}" data-updenavl="{$al.name}"><i class="am-icon-plus"></i> 修改条目</a>&nbsp;
                        <a class="btn btn-xs btn-default" href="javascript:;" data-updeexid="{$al.num}" data-updeexvl="{$al.exp}"><i class="am-icon-plus"></i> 修改内容</a>&nbsp;
                        <a class="btn btn-danger btn-xs" href="javascript:;" data-redeid="{$al.num}"><i class="am-icon-trash"></i>删除整条</a></td>
                    </tr>
                  </volist>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div data-am-widget="gotop" class="am-gotop am-gotop-default">
        <a href="#top" class="next1" title="确认下一项">
          <span class="am-gotop-title">确认下一项</span>
          <i class="am-gotop-icon am-icon-chevron-up"></i>
        </a>
      </div>
    </div>
    <div class="container-fluid page2">
      <div class="row">
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <table id="datatable2" class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th class="col-2" style=“width:15%">疾病名称</th>
                    <th class="col-8" style='width:60%'>疾病释义</th>
                    <th class="col-2" style='width:25%'>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <volist name="illlist" id="al">
                    <tr>
                      <td>{$al.illname} </td>
                      <td>{$al.illexp}</td>
                      <td>
                        <a class="btn btn-xs btn-default" href="javascript:;" data-upilnaid="{$al.num}" data-upilnavl="{$al.illname}"><i class="am-icon-plus"></i> 修改条目</a>&nbsp;
                        <a class="btn btn-xs btn-default" href="javascript:;" data-upilexid="{$al.num}" data-upilexvl="{$al.illexp}"><i class="am-icon-plus"></i> 修改内容</a>&nbsp;
                        <a class="btn btn-danger btn-xs" href="javascript:;" data-reilid="{$al.num}"><i class="am-icon-trash"></i>删除整条</a></td>
                    </tr>
                  </volist>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div data-am-widget="gotop" class="am-gotop am-gotop-default">
        <a href="#top" class="next2" title="确认下一项">
          <span class="am-gotop-title">确认下一项</span>
          <i class="am-gotop-icon am-icon-chevron-up"></i>
        </a>
      </div>
    </div>
    <div class="container-fluid page3">
      <div class="row">
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <table id="datatable3" class="table table-striped table-hover">

                <thead>
                  <tr>
                    <th class="col-2" style=“width:20%">num</th>
                    <th class="col-8" style='width:60%'>标签项</th>
                    <th class="col-2" style='width:20%'>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <volist name="tag" id="tg">
                    <tr>
                      <td>{$tg.num}</td>
                      <td>{$tg.tag2}</td>
                      <td>
                        <a class="btn btn-danger btn-xs" href="javascript:;" data-remove="{$tg.num}"><i class="am-icon-trash"></i></a></td>
                    </tr>
                  </volist>
                </tbody>
  <a id ="add" class="btn btn-xs btn-default" style="float:right;" href="javascript:;" data-update="{$tg.num}"><i class="am-icon-plus"></i> 添加新的标签项</a>&nbsp;
              </table>
            </div>
          
          </div>
        </div>

      </div>
      <button type="button" style='float: right; margin-bottom: 5rem' class="am-btn am-btn-secondary next3">确认下一项</button>
    </div>
    <div class="page4  panel panel-default">
      <div class="am-form-group am-container" style="margin-top: 5rem">
        <div class='am-g' style="height: 4rem ;font-size: 2rem;">
          勾选保险标签
        </div>
        <small>可多选，最多显示3条</small>
        <div class="label_ku" style="margin-top: 2rem">
          <volist name="right" id='ri'>
            <label class="am-checkbox-inline" style="min-width: 30rem;margin-left: 0">
              <input type="checkbox"  value="{$ri.tag1}"> {$ri.tag1}
            </label>
          </volist>
        </div>
        <p><button type="submit" id ="confirm" class="am-btn am-btn-default" style="margin-top:3rem">确认提交</button></p>
      </div>
    </div>
  </div>
</block>
<block name="script">
  <script src="__PUBLIC__/Admin/vendor/datatables/media/js/jquery.dataTables.min.js"></script>
  <script src="__PUBLIC__/Admin/vendor/datatables-colvis/js/dataTables.colVis.js"></script>
  <script src="__PUBLIC__/Admin/vendor/datatables/media/js/dataTables.bootstrap.js"></script>
  <script src="__PUBLIC__/Admin/vendor/sweetalert/dist/sweetalert.min.js"></script>
  <script src="__PUBLIC__/Admin/vendor/moment/min/moment-with-locales.min.js"></script>
  <script src="__PUBLIC__/Admin/vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
  <script>
  $(function() {
    $("#confirm").click(function() {
        var chk_value =[0,0,0,0];
    
        $('input:checkbox:checked').each(function(index){
          if(index>=4){
            return 0 ;
          }
          chk_value[index]=$(this).val();
        });

        $.post('/admin2/manage/add_right', { id: {$id},tag1:chk_value[0],tag2:chk_value[1],tag3:chk_value[2],tag4:chk_value[3] }, function(res) {

              if (res == "ok") {
                swal({
                  title: "添加合同成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/index";
                });
              } else {
                swal({
                  title: "添加合同失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          });
    
    var page = {$page};
    if (page == 0) {
      $(".page1").css('display', '');
      $(".page2").css('display', 'none');
      $(".page3").css('display', 'none');
      $(".page4").css('display', 'none');
    }
    if (page == 1) {
      $(".page2").css('display', '');
      $(".page1").css('display', 'none');
      $(".page3").css('display', 'none');
      $(".page4").css('display', 'none');
    }
    if (page == 2) {
      $(".page3").css('display', '');
      $(".page1").css('display', 'none');
      $(".page2").css('display', 'none');
      $(".page4").css('display', 'none');
    }

   if (page == 3) {
      $(".page4").css('display', '');
      $(".page1").css('display', 'none');
      $(".page2").css('display', 'none');
      $(".page3").css('display', 'none');
    }


    $(".next1").click(function() {
      $(".page1").css('display', 'none');
      $(".page2").css('display', '');
      page = 1;
    });
    $(".next2").click(function() {
      $(".page2").css('display', 'none');
      $(".page3").css('display', '');
      page = 2;
    });
    $(".next3").click(function() {
      $(".page3").css('display', 'none');
      $(".page4").css('display', '');
      page = 3;
    })

    $('#datatable3').dataTable({
      dom: 'lfrt<"table-toolbar mv-lg">p',
      paging: false,
      ordering: false,
      info: true,
      autoWidth: false,
      searching : false,
      oLanguage: {
        
        sZeroRecords: '没有相关记录',
        sInfoEmpty: '0条记录'
      }
    });


    //删除条目
    $('#datatable3').on('click', '[data-remove]', function() {
      var num = $(this).data('remove');
      swal({
          title: "确认删除该条数据?",
          text: "删除后将无法恢复，请谨慎操作",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "是的",
          cancelButtonText: "取消",
          closeOnConfirm: false
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/delete_tag', { id: num }, function(res) {
              if (res == "ok") {
                swal({
                  title: "删除成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "删除失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }
        });
    });
    //添加条目
    $('#add').on('click', function() {
      
      
      swal({
          title: "添加条目",
          text: "添加条目",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "确认添加",
          cancelButtonText: "取消",
          closeOnConfirm: false,
          inputValue: ""
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/add_tag', { id: {$id}, value: inputValue }, function(res) {
              if (res == "ok") {
                swal({
                  title: "修改成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "修改失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }


        });
    });


    $('#datatable2').dataTable({
      dom: 'lfrt<"table-toolbar mv-lg">p',
      paging: false,
      ordering: false,
      info: true,
      autoWidth: false,
      oLanguage: {
        sSearch: '搜索',
        sZeroRecords: '没有相关记录',
        sInfoEmpty: '0条记录'
      }
    });


    //删除条目
    $('#datatable2').on('click', '[data-reilid]', function() {
      var num = $(this).data('reilid');
      swal({
          title: "确认删除该条数据?",
          text: "删除后将无法恢复，请谨慎操作",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "是的",
          cancelButtonText: "取消",
          closeOnConfirm: false
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/delete_il', { id: num }, function(res) {
              if (res == "ok") {
                swal({
                  title: "删除成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "删除失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }
        });
    });
    //修改条目
    $('#datatable2').on('click', '[data-upilnaid]', function() {


      var name = $(this).data('upilnavl');
      var num = $(this).data('upilnaid');
      swal({
          title: "修改内容",
          text: "修改条目",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "修改完毕",
          cancelButtonText: "取消",
          closeOnConfirm: false,
          inputValue: name
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/update_il_name', { id: num, value: inputValue }, function(res) {
              if (res == "ok") {
                swal({
                  title: "修改成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "修改失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }


        });
    });

    //修改释义
    $('#datatable2').on('click', '[data-upilexid]', function() {
      var exp = $(this).data('upilexvl');
      var num = $(this).data('upilexid');
      swal({
          title: "修改内容",
          text: "修改内容",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "修改完毕",
          cancelButtonText: "取消",
          closeOnConfirm: false,
          inputValue: exp
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/update_il_exp', { id: num, value: inputValue }, function(res) {
              if (res == "ok") {
                swal({
                  title: "修改成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "修改失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }
        });
    });


    //datatable初始化
    $('#datatable').dataTable({
      dom: 'lfrt<"table-toolbar mv-lg">p',
      paging: false,
      ordering: false,
      info: true,
      autoWidth: false,
      oLanguage: {
        sSearch: '搜索',
        sZeroRecords: '没有相关记录',
        sInfoEmpty: '0条记录'
      }
    });

    $("#datetimepicker-start").on("dp.change", function(e) {
      $("#datetimepicker-end").data("DateTimePicker").minDate(e.date);
    });
    $("#datetimepicker-end").on("dp.change", function(e) {
      $("#datetimepicker-start").data("DateTimePicker").maxDate(e.date);
    });

    //删除条目
    $('#datatable').on('click', '[data-redeid]', function() {
      var num = $(this).data('redeid');
      swal({
          title: "确认删除该条数据?",
          text: "删除后将无法恢复，请谨慎操作",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "是的",
          cancelButtonText: "取消",
          closeOnConfirm: false
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/delete_de', { id: num }, function(res) {
              if (res == "ok") {
                swal({
                  title: "删除成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "删除失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }
        });
    });
    //修改条目
    $('#datatable').on('click', '[data-updenaid]', function() {


      var name = $(this).data('updenavl');
      var num = $(this).data('updenaid');
      swal({
          title: "修改内容",
          text: "修改条目",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "修改完毕",
          cancelButtonText: "取消",
          closeOnConfirm: false,
          inputValue: name
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/update_de_name', { id: num, value: inputValue }, function(res) {
              if (res == "ok") {
                swal({
                  title: "修改成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "修改失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }


        });
    });

    //修改释义
    $('#datatable').on('click', '[data-updeexid]', function() {
      var exp = $(this).data('updeexvl');
      var num = $(this).data('updeexid');
      swal({
          title: "修改内容",
          text: "修改内容",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "修改完毕",
          cancelButtonText: "取消",
          closeOnConfirm: false,
          inputValue: exp
        },
        function(inputValue) {
          if (inputValue) {
            $.post('/admin2/manage/update_de_exp', { id: num, value: inputValue }, function(res) {
              if (res == "ok") {
                swal({
                  title: "修改成功",
                  type: "success",
                }, function() {
                  window.location.href = "/admin2/manage/get_data_all/id/" + {$id} + "/page/" + page;
                });
              } else {
                swal({
                  title: "修改失败",
                  type: "failed",
                }, function() {

                });
              }
            });
          }
        });
    });
  });

  </script>
</block>
</extend>
